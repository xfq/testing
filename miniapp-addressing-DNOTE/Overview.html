<!DOCTYPE html><html lang="en" class="is-multilingual"><head>
<meta charset="utf-8">
<meta name="generator" content="ReSpec 31.0.11">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<style>
span.example-title{text-transform:none}
:is(aside,div).example,div.illegal-example{padding:.5em;margin:1em 0;position:relative;clear:both}
div.illegal-example{color:red}
div.illegal-example p{color:#000}
:is(aside,div).example{border-left-width:.5em;border-left-style:solid;border-color:#e0cb52;background:#fcfaee}
aside.example div.example{border-left-width:.1em;border-color:#999;background:#fff}
.example pre{background-color:rgba(0,0,0,.03)}
</style>
<style>
dfn{cursor:pointer}
.dfn-panel{position:absolute;z-index:35;min-width:300px;max-width:500px;padding:.5em .75em;margin-top:.6em;font:small Helvetica Neue,sans-serif,Droid Sans Fallback;background:#fff;color:#000;box-shadow:0 1em 3em -.4em rgba(0,0,0,.3),0 0 1px 1px rgba(0,0,0,.05);border-radius:2px}
.dfn-panel:not(.docked)>.caret{position:absolute;top:-9px}
.dfn-panel:not(.docked)>.caret::after,.dfn-panel:not(.docked)>.caret::before{content:"";position:absolute;border:10px solid transparent;border-top:0;border-bottom:10px solid #fff;top:0}
.dfn-panel:not(.docked)>.caret::before{border-bottom:9px solid #a2a9b1}
.dfn-panel *{margin:0}
.dfn-panel b{display:block;color:#000;margin-top:.25em}
.dfn-panel ul a[href]{color:#333}
.dfn-panel>div{display:flex}
.dfn-panel a.self-link{font-weight:700;margin-right:auto}
.dfn-panel .marker{padding:.1em;margin-left:.5em;border-radius:.2em;text-align:center;white-space:nowrap;font-size:90%;color:#040b1c}
.dfn-panel .marker.dfn-exported{background:#d1edfd;box-shadow:0 0 0 .125em #1ca5f940}
.dfn-panel .marker.idl-block{background:#8ccbf2;box-shadow:0 0 0 .125em #0670b161}
.dfn-panel a:not(:hover){text-decoration:none!important;border-bottom:none!important}
.dfn-panel a[href]:hover{border-bottom-width:1px}
.dfn-panel ul{padding:0}
.dfn-panel li{margin-left:1em}
.dfn-panel.docked{position:fixed;left:.5em;top:unset;bottom:2em;margin:0 auto;max-width:calc(100vw - .75em * 2 - .5em - .2em * 2);max-height:30vh;overflow:auto}
</style>
    
    
<title>MiniApp Addressing</title>

    
<link rel="stylesheet" href="./local.css">

    
<style>

    table {
      border-collapse:collapse;
    }

    table,th, td {
      border: 1px solid #666;
    }

    td {
      padding:2px 15px;
    }
    
</style>

    
    
<script defer="" src="./script.js"></script>

    

<style id="respec-mainstyle">
@keyframes pop{
0%{transform:scale(1,1)}
25%{transform:scale(1.25,1.25);opacity:.75}
100%{transform:scale(1,1)}
}
:is(h1,h2,h3,h4,h5,h6,a) abbr{border:none}
dfn{font-weight:700}
a.internalDFN{color:inherit;border-bottom:1px solid #99c;text-decoration:none}
a.externalDFN{color:inherit;border-bottom:1px dotted #ccc;text-decoration:none}
a.bibref{text-decoration:none}
.respec-offending-element:target{animation:pop .25s ease-in-out 0s 1}
.respec-offending-element,a[href].respec-offending-element{text-decoration:red wavy underline}
@supports not (text-decoration:red wavy underline){
.respec-offending-element:not(pre){display:inline-block}
.respec-offending-element{background:url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=) bottom repeat-x}
}
#references :target{background:#eaf3ff;animation:pop .4s ease-in-out 0s 1}
cite .bibref{font-style:normal}
code{color:#c63501}
th code{color:inherit}
a[href].orcid{padding-left:4px;padding-right:4px}
a[href].orcid>svg{margin-bottom:-2px}
.toc a,.tof a{text-decoration:none}
a .figno,a .secno{color:#000}
ol.tof,ul.tof{list-style:none outside none}
.caption{margin-top:.5em;font-style:italic}
table.simple{border-spacing:0;border-collapse:collapse;border-bottom:3px solid #005a9c}
.simple th{background:#005a9c;color:#fff;padding:3px 5px;text-align:left}
.simple th a{color:#fff;padding:3px 5px;text-align:left}
.simple th[scope=row]{background:inherit;color:inherit;border-top:1px solid #ddd}
.simple td{padding:3px 10px;border-top:1px solid #ddd}
.simple tr:nth-child(even){background:#f0f6ff}
.section dd>p:first-child{margin-top:0}
.section dd>p:last-child{margin-bottom:0}
.section dd{margin-bottom:1em}
.section dl.attrs dd,.section dl.eldef dd{margin-bottom:0}
#issue-summary>ul{column-count:2}
#issue-summary li{list-style:none;display:inline-block}
details.respec-tests-details{margin-left:1em;display:inline-block;vertical-align:top}
details.respec-tests-details>*{padding-right:2em}
details.respec-tests-details[open]{z-index:999999;position:absolute;border:thin solid #cad3e2;border-radius:.3em;background-color:#fff;padding-bottom:.5em}
details.respec-tests-details[open]>summary{border-bottom:thin solid #cad3e2;padding-left:1em;margin-bottom:1em;line-height:2em}
details.respec-tests-details>ul{width:100%;margin-top:-.3em}
details.respec-tests-details>li{padding-left:1em}
.self-link:hover{opacity:1;text-decoration:none;background-color:transparent}
aside.example .marker>a.self-link{color:inherit}
.header-wrapper{display:flex;align-items:baseline}
:is(h2,h3,h4,h5,h6):not(#toc>h2,#abstract>h2,#sotd>h2,.head>h2){position:relative;left:-.5em}
:is(h2,h3,h4,h5,h6):not(#toch2)+a.self-link{color:inherit;order:-1;position:relative;left:-1.1em;font-size:1rem;opacity:.5}
:is(h2,h3,h4,h5,h6)+a.self-link::before{content:"§";text-decoration:none;color:var(--heading-text)}
:is(h2,h3)+a.self-link{top:-.2em}
:is(h4,h5,h6)+a.self-link::before{color:#000}
@media (max-width:767px){
dd{margin-left:0}
}
@media print{
.removeOnSave{display:none}
}
</style>
<meta name="description" content="This specification defines how MiniApps are located, which is called MiniApp Addressing, including the specifications for specific MiniApp URI syntax components based on the URI specification, and the process to dereference the MiniApp URI. Implementing this specification enables the user agent to locate the resources of MiniApp.">
<link rel="canonical" href="https://www.w3.org/TR/miniapp-addressing/">
<style>
.hljs{display:block;overflow-x:auto;padding:.5em;color:#383a42;background:#fafafa}
.hljs-comment,.hljs-quote{color:#717277;font-style:italic}
.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}
.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#ca4706;font-weight:700}
.hljs-literal{color:#0b76c5}
.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#42803c}
.hljs-built_in,.hljs-class .hljs-title{color:#9a6a01}
.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}
.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#336ae3}
.hljs-emphasis{font-style:italic}
.hljs-strong{font-weight:700}
.hljs-link{text-decoration:underline}
</style>
<style>
var{position:relative;cursor:pointer}
var[data-type]::after,var[data-type]::before{position:absolute;left:50%;top:-6px;opacity:0;transition:opacity .4s;pointer-events:none}
var[data-type]::before{content:"";transform:translateX(-50%);border-width:4px 6px 0 6px;border-style:solid;border-color:transparent;border-top-color:#000}
var[data-type]::after{content:attr(data-type);transform:translateX(-50%) translateY(-100%);background:#000;text-align:center;font-family:"Dank Mono","Fira Code",monospace;font-style:normal;padding:6px;border-radius:3px;color:#daca88;text-indent:0;font-weight:400}
var[data-type]:hover::after,var[data-type]:hover::before{opacity:1}
</style>
<script id="initialUserConfig" type="application/json">{
  "specStatus": "DNOTE",
  "publishDate": "2022-03-10",
  "copyrightStart": "2020",
  "edDraftURI": "https://w3c.github.io/miniapp-addressing/",
  "shortName": "miniapp-addressing",
  "noRecTrack": true,
  "editors": [
    {
      "name": "Dan Zhou",
      "companyURL": "https://www.baidu.com/",
      "company": "Baidu, Inc",
      "w3cid": 118521
    },
    {
      "name": "Qian Liu",
      "companyURL": "https://www.baidu.com/",
      "company": "Baidu, Inc",
      "w3cid": 119120
    },
    {
      "name": "Shuo Wang",
      "companyURL": "https://www.baidu.com/",
      "company": "Baidu, Inc",
      "w3cid": 118600
    },
    {
      "name": "Tengyuan Zhang",
      "companyURL": "https://www.baidu.com/",
      "company": "Baidu, Inc",
      "w3cid": 118561
    }
  ],
  "formerEditors": [
    {
      "name": "Zhixing Lei",
      "companyURL": "https://www.baidu.com/",
      "company": "Baidu, Inc",
      "w3cid": 53404
    }
  ],
  "group": "wg/miniapps",
  "github": {
    "repoURL": "https://github.com/w3c/miniapp-addressing",
    "branch": "main"
  },
  "publishISODate": "2022-03-10T00:00:00.000Z",
  "generatedSubtitle": "W3C Group Draft Note 10 March 2022"
}</script>
<link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2021/W3C-DNOTE"></head>

<body class="h-entry"><div class="head">
    <p class="logos"><a class="logo" href="https://www.w3.org/"><img crossorigin="" alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72">
  </a></p>
    <h1 id="title" class="title">MiniApp Addressing</h1> 
    <p id="w3c-state"><a href="https://www.w3.org/standards/types#DNOTE">W3C Group Draft Note</a> <time class="dt-published" datetime="2022-03-10">10 March 2022</time></p>
    <details open="">
      <summary data-original-text="More details about this document">More details about this document</summary>
      <dl>
        <dt data-original-text="This version:">This version:</dt><dd>
                <a class="u-url" href="https://www.w3.org/TR/2022/DNOTE-miniapp-addressing-20220310/">https://www.w3.org/TR/2022/DNOTE-miniapp-addressing-20220310/</a>
              </dd>
        <dt data-original-text="Latest published version:">Latest published version:</dt><dd>
                <a href="https://www.w3.org/TR/miniapp-addressing/">https://www.w3.org/TR/miniapp-addressing/</a>
              </dd>
        <dt data-original-text="Latest editor's draft:">Latest editor's draft:</dt><dd><a href="https://w3c.github.io/miniapp-addressing/">https://w3c.github.io/miniapp-addressing/</a></dd>
        <dt data-original-text="History:">History:</dt><dd>
                    <a href="https://github.com/w3c/miniapp-addressing/commits/main">Commit history</a>
                  </dd>
        
        
        
        
        
        <dt data-original-text="Editors:">Editors:</dt><dd class="editor p-author h-card vcard" data-editor-id="118521">
    <span class="p-name fn">Dan Zhou</span> (<a class="p-org org h-org" href="https://www.baidu.com/">Baidu, Inc</a>)
  </dd><dd class="editor p-author h-card vcard" data-editor-id="119120">
    <span class="p-name fn">Qian Liu</span> (<a class="p-org org h-org" href="https://www.baidu.com/">Baidu, Inc</a>)
  </dd><dd class="editor p-author h-card vcard" data-editor-id="118600">
    <span class="p-name fn">Shuo Wang</span> (<a class="p-org org h-org" href="https://www.baidu.com/">Baidu, Inc</a>)
  </dd><dd class="editor p-author h-card vcard" data-editor-id="118561">
    <span class="p-name fn">Tengyuan Zhang</span> (<a class="p-org org h-org" href="https://www.baidu.com/">Baidu, Inc</a>)
  </dd>
        <dt data-original-text="Former editor:">Former editor:</dt><dd class="editor p-author h-card vcard" data-editor-id="53404">
    <span class="p-name fn">Zhixing Lei</span> (<a class="p-org org h-org" href="https://www.baidu.com/">Baidu, Inc</a>)
  </dd>
        
        <dt data-original-text="Feedback:">Feedback:</dt><dd>
        <a href="https://github.com/w3c/miniapp-addressing/">GitHub w3c/miniapp-addressing</a>
        (<a href="https://github.com/w3c/miniapp-addressing/pulls/">pull requests</a>,
        <a href="https://github.com/w3c/miniapp-addressing/issues/new/choose">new issue</a>,
        <a href="https://github.com/w3c/miniapp-addressing/issues/">open issues</a>)
      </dd>
        
        
      </dl>
    </details>
    
    
    <p class="copyright">
    <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>
    ©
    2020-2022
    
    <a href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="https://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>,
    <a href="https://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="https://www.keio.ac.jp/">Keio</a>,
    <a href="https://ev.buaa.edu.cn/">Beihang</a>). W3C
    <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
    <a href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and
    <a rel="license" href="https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document" title="W3C Software and Document Notice and License">permissive document license</a> rules apply.
  </p>
    <hr title="Separator for header">
  </div>
    <section id="abstract" class="introductory"><h2>Abstract</h2>
        <p its-locale-filter-list="en" lang="en">
          This specification defines how MiniApps are located, which is called MiniApp Addressing, including the specifications for specific MiniApp URI syntax components based on the URI specification, and the process to dereference the MiniApp URI. Implementing this specification enables the user agent to locate the resources of MiniApp.
        </p>
        <p its-locale-filter-list="zh-hans" lang="zh-hans">
          本规范定义了 MiniApp Addressing 的方式，包含基于 URI 规范之上的 MiniApp URI 的具体语法组件的规格说明，以及解引用 MiniApp URI 的过程。实现本规范，能使得 user agent 能够定位 MiniApp 的资源。
        </p>
    </section>
    <section id="sotd" class="introductory"><h2>Status of This Document</h2><p><em>This section describes the status of this
      document at the time of its publication. A list of current <abbr title="World Wide Web Consortium">W3C</abbr>
      publications and the latest revision of this technical report can be found
      in the <a href="https://www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr> technical reports index</a> at
      https://www.w3.org/TR/.</em></p>
        <p id="langSwitch">
          <button onclick="switchLang('zh-hans')" lang="zh-hans">简体中文</button>
          <button onclick="switchLang('en')" lang="en">English</button>
          <button onclick="switchLang('all')" lang="en">All</button>
        </p>

        <p its-locale-filter-list="en" lang="en">
          The Working Group is publishing this specification as a Draft Note to encourage early review. This specification is not yet on the <abbr title="World Wide Web Consortium">W3C</abbr> standards track.
        </p>
        <p its-locale-filter-list="zh-hans" lang="zh-hans">
          MiniApps 工作组将本规范作为备忘草案发布，以鼓励对该文档的早期审阅。该规范尚未进入 <abbr title="World Wide Web Consortium">W3C</abbr> 标准轨道。
        </p>
    <p>
    This document was published by the <a href="https://www.w3.org/groups/wg/miniapps">MiniApps Working Group</a> as
    a Group Draft Note using the
        <a href="https://www.w3.org/2021/Process-20211102/#recs-and-notes">Note track</a>. 
  </p><p>Group Draft Notes are not endorsed by
        <abbr title="World Wide Web Consortium">W3C</abbr> nor its Members. </p><p>
    This is a draft document and may be updated, replaced or obsoleted by other
    documents at any time. It is inappropriate to cite this document as other
    than work in progress.
    
  </p><p data-deliverer="128558">
    
        The
        <a href="https://www.w3.org/Consortium/Patent-Policy/"><abbr title="World Wide Web Consortium">W3C</abbr> Patent
          Policy</a>
        does not carry any licensing requirements or commitments on this
        document.
      
    
  </p><p>
                  This document is governed by the
                  <a id="w3c_process_revision" href="https://www.w3.org/2021/Process-20211102/">2 November 2021 <abbr title="World Wide Web Consortium">W3C</abbr> Process Document</a>.
                </p></section><nav id="toc"><h2 class="introductory" id="table-of-contents">Table of Contents</h2><ol class="toc"><li class="tocline"><a class="tocxref" href="#abstract">Abstract</a></li><li class="tocline"><a class="tocxref" href="#sotd">Status of This Document</a></li><li class="tocline"><a class="tocxref" href="#introduction"><bdi class="secno">1. </bdi>
        <span its-locale-filter-list="en" lang="en">Introduction</span>
        <span its-locale-filter-list="zh-hans" lang="zh-hans">介绍</span>
      </a></li><li class="tocline"><a class="tocxref" href="#examples"><bdi class="secno">2. </bdi>
        <span its-locale-filter-list="en" lang="en">Example of usage</span>
        <span its-locale-filter-list="zh-hans" lang="zh-hans">用例</span>
      </a><ol class="toc"><li class="tocline"><a class="tocxref" href="#example-1-open-a-mini-app-on-web-page-1-web"><bdi class="secno">2.1 </bdi>
            <span its-locale-filter-list="en" lang="en">Example 1: Open a mini app on Web page</span>
            <span its-locale-filter-list="zh-hans" lang="zh-hans">用例1：在 Web 页面中打开一个小程序</span>
          </a></li><li class="tocline"><a class="tocxref" href="#example-2-access-a-mini-app-package-in-a-development-environment-2"><bdi class="secno">2.2 </bdi>
            <span its-locale-filter-list="en" lang="en">Example 2: Access a mini app package in a development environment</span>
            <span its-locale-filter-list="zh-hans" lang="zh-hans">用例2：在开发环境中访问小程序包</span>
          </a></li></ol></li><li class="tocline"><a class="tocxref" href="#user-agent"><bdi class="secno">3. </bdi>
            <span its-locale-filter-list="en" lang="en">User agent</span>
            <span its-locale-filter-list="zh-hans" lang="zh-hans">客户端</span>
          </a></li><li class="tocline"><a class="tocxref" href="#syntax"><bdi class="secno">4. </bdi>
            <span its-locale-filter-list="en" lang="en">Syntax</span>
            <span its-locale-filter-list="zh-hans" lang="zh-hans">语法</span>
          </a><ol class="toc"><li class="tocline"><a class="tocxref" href="#custom-scheme"><bdi class="secno">4.1 </bdi>custom-scheme</a></li><li class="tocline"><a class="tocxref" href="#id"><bdi class="secno">4.2 </bdi>id</a></li><li class="tocline"><a class="tocxref" href="#version"><bdi class="secno">4.3 </bdi>Version</a></li><li class="tocline"><a class="tocxref" href="#host-host"><bdi class="secno">4.4 </bdi>
              <span its-locale-filter-list="en" lang="en">Host</span>
              <span its-locale-filter-list="zh-hans" lang="zh-hans">host</span>
            </a></li><li class="tocline"><a class="tocxref" href="#path"><bdi class="secno">4.5 </bdi>Path</a></li><li class="tocline"><a class="tocxref" href="#query-and-fragment-query-fragment"><bdi class="secno">4.6 </bdi>
              <span its-locale-filter-list="en" lang="en">Query and fragment</span>
              <span its-locale-filter-list="zh-hans" lang="zh-hans">query 与 fragment</span>
            </a></li></ol></li><li class="tocline"><a class="tocxref" href="#dereferencing"><bdi class="secno">5. </bdi>
              <span its-locale-filter-list="en" lang="en">Dereferencing</span>
              <span its-locale-filter-list="zh-hans" lang="zh-hans">解引用</span>
            </a></li><li class="tocline"><a class="tocxref" href="#https"><bdi class="secno">6. </bdi>
                <span its-locale-filter-list="en" lang="en">Use HTTPS as a network protocol to download MiniApp packages</span>
                <span its-locale-filter-list="zh-hans" lang="zh-hans">使用 HTTPS 协议作为下载小程序包的网络协议</span>
              </a></li><li class="tocline"><a class="tocxref" href="#conformance"><bdi class="secno">7. </bdi>
                  <span its-locale-filter-list="en" lang="en">Conformance</span>
                  <span its-locale-filter-list="zh-hans" lang="zh-hans">标准符合性</span>
                </a></li><li class="tocline"><a class="tocxref" href="#security-considerations"><bdi class="secno">8. </bdi>
                  <span its-locale-filter-list="en" lang="en">Security Considerations</span>
                  <span its-locale-filter-list="zh-hans" lang="zh-hans">安全性考虑</span>
                </a></li><li class="tocline"><a class="tocxref" href="#acknowledgments"><bdi class="secno">A. </bdi>
        <span its-locale-filter-list="en" lang="en">Acknowledgments</span>
        <span its-locale-filter-list="zh-hans" lang="zh-hans">致谢</span>
      </a></li><li class="tocline"><a class="tocxref" href="#references-0"><bdi class="secno">B. </bdi>
        <span its-locale-filter-list="en" lang="en">References</span>
        <span its-locale-filter-list="zh-hans" lang="zh-hans">引用</span>
      </a></li><li class="tocline"><a class="tocxref" href="#references"><bdi class="secno">C. </bdi>References</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#normative-references"><bdi class="secno">C.1 </bdi>Normative references</a></li><li class="tocline"><a class="tocxref" href="#informative-references"><bdi class="secno">C.2 </bdi>Informative references</a></li></ol></li></ol></nav>

    <section class="informative" id="introduction"><div class="header-wrapper"><h2 id="x1-introduction"><bdi class="secno">1. </bdi>
        <span its-locale-filter-list="en" lang="en">Introduction</span>
        <span its-locale-filter-list="zh-hans" lang="zh-hans">介绍</span>
      </h2><a class="self-link" href="#introduction" aria-label="Permalink for Section 1."></a></div><p><em>This section is non-normative.</em></p>
      
        <p its-locale-filter-list="en" lang="en">
           Mini apps are applications that run on the user agent and are based on Web technology combined with native application technology. The [<cite><a class="bibref" data-link-type="biblio" href="#bib-miniapp-packaging" title="MiniApp Packaging">MINIAPP-PACKAGING</a></cite>] specification defines the form of resources in the mini app, as well as the specific path in the mini app and the mapped path relationship in the MiniApp URI scheme.
          The source used by the user agent to get the MiniApp package, called <i>package provider</i> in the following.
        </p>
        <p its-locale-filter-list="zh-hans" lang="zh-hans">小程序是运行在 user agent 上的，基于 Web 技术，结合原生应用技术实现的应用。在 [<cite><a class="bibref" data-link-type="biblio" href="#bib-miniapp-packaging" title="MiniApp Packaging">MINIAPP-PACKAGING</a></cite>] 规范中定义了小程序内资源的形式，以及小程序内具体的资源路径和 MiniApp URI 中的 path 映射关系。
          用于 user agent 获取小程序包的来源，在下文中称为 package provider。
        </p>

        <p its-locale-filter-list="en" lang="en">MiniApp Addressing is a technology that uniquely corresponds to a specific resource within a mini app. The MiniApp Addressing uses the Mobile Deep Linking technology. The prefix of the URI depends on how the device system supports it and which is selected by the user agent. The rest part of the URI follows the specification in the syntax section below, which describes the specifications and definitions of some syntax components of the URI in the mini app. Parts not covered in these specifications follow the URI specifications and are not repeated here.</p>
        <p its-locale-filter-list="zh-hans" lang="zh-hans">
          MiniApp Addressing 是用于唯一对应一个小程序内的具体资源的技术。MiniApp Addressing 使用了 Mobile Deep Linking 技术，URI 的前缀取决于系统的支持方式及 user agent 所选取的方式。URI 的其他语法部分遵循下文中 MiniApp URI 语法章节中的规范，该章节描述了 URI 的某些语法部件在小程序中的规范与含义，本规范未涉及到的部分，沿用 URI 的规范，不再在本规范中赘述。
        </p>
    </section>

    <section class="informative" id="examples"><div class="header-wrapper"><h2 id="x2-example-of-usage"><bdi class="secno">2. </bdi>
        <span its-locale-filter-list="en" lang="en">Example of usage</span>
        <span its-locale-filter-list="zh-hans" lang="zh-hans">用例</span>
      </h2><a class="self-link" href="#examples" aria-label="Permalink for Section 2."></a></div><p><em>This section is non-normative.</em></p>
      
        <p its-locale-filter-list="en" lang="en">The following is an example of MiniApp URI.</p>
        <p its-locale-filter-list="zh-hans" lang="zh-hans">以下是两个 MiniApp URI 的例子</p>

        <pre aria-busy="false"><code class="hljs javascript">platform:<span class="hljs-comment">//miniapp/foo;version=1.0.1-trial/pages/index?k=v#bar</span></code></pre>
        <pre aria-busy="false"><code class="hljs javascript">https:<span class="hljs-comment">//platform.org/miniapp/foo;version=1.0.1-trial/pages/index?k=v#bar</span></code></pre>

        <section id="example-1-open-a-mini-app-on-web-page-1-web"><div class="header-wrapper"><h3 id="x2-1-example-1-open-a-mini-app-on-web-page-1-web"><bdi class="secno">2.1 </bdi>
            <span its-locale-filter-list="en" lang="en">Example 1: Open a mini app on Web page</span>
            <span its-locale-filter-list="zh-hans" lang="zh-hans">用例1：在 Web 页面中打开一个小程序</span>
          </h3><a class="self-link" href="#example-1-open-a-mini-app-on-web-page-1-web" aria-label="Permalink for Section 2.1"></a></div>
          

          <div class="example" id="example-1">
        <div class="marker">
    <a class="self-link" href="#example-1">Example<bdi> 1</bdi></a>
  </div> <pre aria-busy="false"><code class="hljs html"><span class="hljs-meta">&lt;!doctype <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"platform://miniapp/foo;version=1.0.1-trial/pages/index?category=book#section-3"</span>&gt;</span>open a MiniApp<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre>
      </div>

        <p its-locale-filter-list="en" lang="en">Embed an <code>a</code> element with the <code>href</code> attribute as the mini app URI on the web page. When a user clicks the link, if the environment on which the web page is running can't handle the URL, the os will distributes it to a proper user agent based on the URI prefix. And the user agent receives the URI and dereferences it. Based on the host, id, version in the URI, a request is made to a specific package server that can provide mini app package upload and download services, to download and open the corresponding mini app.</p>
        <p its-locale-filter-list="zh-hans" lang="zh-hans">在 Web 页面中嵌入一个 href 属性为小程序 URI 的 <code>a</code> 元素。当用户点击该链接时，如果 Web 页面所运行的环境不能正确处理该 URL，则会由操作系统根据 URI 的前缀将其分发能处理的 user agent。User agent 会接收到该 URI，并对该 URI 解引用，根据 URI 中的 id、version 请求特定的能提供小程序包上传和下载服务的 package server，下载并打开对应的小程序。</p>

        <p its-locale-filter-list="en" lang="en">As shown in the following flowchart, the package is a collection of mini app resource packages, and the content and structure of the packages are defined in the <a href="https://www.w3.org/TR/miniapp-packaging/">packaging specification</a>.</p>
        <p its-locale-filter-list="zh-hans" lang="zh-hans">如下流程图，其中 package 为小程序资源包集合，包的内容和结构由<a href="https://www.w3.org/TR/miniapp-packaging/">包规范</a>定义。</p>

        <figure id="use-case-2">
          <span style="text-align:center;"><img src="images/use-case-2.png" alt="Open a MiniApp from web" width="600"></span>
          <figcaption>Fig. <bdi class="figno">1</bdi> <span class="fig-title">
            <span its-locale-filter-list="en" lang="en">Open a MiniApp from web</span>
            <span its-locale-filter-list="zh-hans" lang="zh-hans">在 Web 中打开一个小程序</span>
          </span></figcaption>
        </figure>

        </section>

        <section id="example-2-access-a-mini-app-package-in-a-development-environment-2"><div class="header-wrapper"><h3 id="x2-2-example-2-access-a-mini-app-package-in-a-development-environment-2"><bdi class="secno">2.2 </bdi>
            <span its-locale-filter-list="en" lang="en">Example 2: Access a mini app package in a development environment</span>
            <span its-locale-filter-list="zh-hans" lang="zh-hans">用例2：在开发环境中访问小程序包</span>
          </h3><a class="self-link" href="#example-2-access-a-mini-app-package-in-a-development-environment-2" aria-label="Permalink for Section 2.2"></a></div>
          

          <p its-locale-filter-list="en" lang="en">The User agent can provide debugging tools for developers to place the mini app package in the user agent development environment. Developers can obtain the unique id and version number of the mini app in the development environment, such as "foo; version = 1.0.1". Developers can concatenate it into a MiniApp URI that opens the mini app:</p>
          <p its-locale-filter-list="zh-hans" lang="zh-hans">User agent 可提供调试工具，用于开发者将小程序包放置于 user agent 开发环境中。开发者有能力获取该开发中的小程序的唯一 id 和版本号，比如 “foo;version=1.0.1”。开发者可将其拼接为能打开该小程序的 MiniApp URI：</p>

          <pre aria-busy="false"><code class="hljs javascript">platform:<span class="hljs-comment">//miniapp/foo;version=1.0.1/pages/index?k=v#bar</span></code></pre>

          <p its-locale-filter-list="en" lang="en">When the user agent dereferences the URI, it obtains the mini app package with the specific identification "foo; version = 1.0.1"&nbsp;in a certain way, and then opens and runs the mini app.</p>
          <p its-locale-filter-list="zh-hans" lang="zh-hans">当 user agent 解引用该 URI 时，会使用某种方式获取到此特定标识为 “foo;version=1.0.1” 的小程序包，并打开和运行。</p>

          <figure id="use-case-3">
            <span style="text-align:center;"><img src="images/use-case-3.png" alt="Open a MiniApp in development environment" width="600"></span>
            <figcaption>Fig. <bdi class="figno">2</bdi> <span class="fig-title">
              <span its-locale-filter-list="en" lang="en">Open a MiniApp in development environment</span>
              <span its-locale-filter-list="zh-hans" lang="zh-hans">在开发环境中打开一个小程序</span>
            </span></figcaption>
          </figure>

          </section>

        </section>

        <section id="user-agent"><div class="header-wrapper"><h2 id="x3-user-agent"><bdi class="secno">3. </bdi>
            <span its-locale-filter-list="en" lang="en">User agent</span>
            <span its-locale-filter-list="zh-hans" lang="zh-hans">客户端</span>
          </h2><a class="self-link" href="#user-agent" aria-label="Permalink for Section 3."></a></div>
          
          <p its-locale-filter-list="en" lang="en">The user agent of Mini App corresponds to the native client implementing this specification. The user agent can parse the MiniApp URI protocol according to the rules of this specification, and it can also point to a certain resource of the unique and correct mini app package based on the MiniApp URI.</p>
          <p its-locale-filter-list="zh-hans" lang="zh-hans">小程序对应的 user agent 即实现了本规范的原生客户端。 User agent 能根据本规范制定的规则解析 MiniApp URI 协议，能根据 MiniApp URI 指向唯一的、正确的小程序包的某资源。</p>
        </section>

        <section id="syntax"><div class="header-wrapper"><h2 id="x4-syntax"><bdi class="secno">4. </bdi>
            <span its-locale-filter-list="en" lang="en">Syntax</span>
            <span its-locale-filter-list="zh-hans" lang="zh-hans">语法</span>
          </h2><a class="self-link" href="#syntax" aria-label="Permalink for Section 4."></a></div>
          
          <p its-locale-filter-list="en" lang="en">
            The MiniApp URI syntax is defined using [<cite><a class="bibref" data-link-type="biblio" href="#bib-abnf" title="Augmented BNF for Syntax Specifications: ABNF">ABNF</a></cite>], using <code>host</code>, <code>path-abempty</code>, <code>query</code>, <code>fragment</code>, and <code>unreserved</code> from [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc3986" title="Uniform Resource Identifier (URI): Generic Syntax">RFC3986</a></cite>].
          </p>
          <p its-locale-filter-list="zh-hans" lang="zh-hans">
            MiniApp URI 语法使用 [<cite><a class="bibref" data-link-type="biblio" href="#bib-abnf" title="Augmented BNF for Syntax Specifications: ABNF">ABNF</a></cite>] 定义，引入 [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc3986" title="Uniform Resource Identifier (URI): Generic Syntax">RFC3986</a></cite>] 的 <code>host</code>、<code>path-abempty</code>、<code>query</code>、<code>fragment</code> 和 <code>unreserved</code>。
          </p>
          <pre aria-busy="false"><code class="hljs abnf"><span class="hljs-attribute">miniappuri</span>    = uri-prefix uri-infix identify path-abempty [<span class="hljs-string">"?"</span> query ] [<span class="hljs-string">"#"</span> fragment ]

<span class="hljs-attribute">uri-prefix</span>    = (custom-scheme <span class="hljs-string">"://"</span>) / (<span class="hljs-string">"https://"</span> host)
<span class="hljs-attribute">custom-scheme</span> = <span class="hljs-number">1</span>*unreserved
<span class="hljs-attribute">uri-infix</span>     =  <span class="hljs-string">"miniapp"</span>
<span class="hljs-attribute">identify</span>      = id [<span class="hljs-string">";version="</span> version]
<span class="hljs-attribute">id</span>            = <span class="hljs-number">1</span>*unreserved
<span class="hljs-attribute">version</span>       = *unreserved</code></pre>

          <p its-locale-filter-list="en" lang="en">The following are the MiniApp URI examples that conform to this syntax rule:</p>
          <p its-locale-filter-list="zh-hans" lang="zh-hans">以下是符合本语法规则的 MiniApp URI 示例：</p>

          <aside class="example" id="example-miniapp-uri-examples"><div class="marker">
    <a class="self-link" href="#example-miniapp-uri-examples">Example<bdi> 2</bdi></a><span class="example-title">: MiniApp URI examples</span>
  </div>
          <ol>
            <li>platform://miniapp/foo</li>
            <li>platform://miniapp/foo/pages/index</li>
            <li>platform://miniapp/foo/widgets/index</li>
            <li>platform://miniapp/foo?category=img</li>
            <li>platform://miniapp/foo;version=1.0.1@example.com/pages/index?category=book#section-3</li>
            <li>platform://miniapp/foo;version=1.0.1-trial@example.com:8080/pages/index?category=book#section-3</li>
          </ol>

          <ol>
            <li>https://platform.org/miniapp/foo</li>
            <li>https://platform.org/miniapp/foo/pages/index</li>
            <li>https://platform.org/miniapp/foo/widgets/index</li>
            <li>https://platform.org/miniapp/foo?category=img</li>
            <li>https://platform.org/miniapp/foo;version=1.0.1/pages/index?k=v#bar</li>
            <li>https://platform.org/miniapp/foo;version=1.0.1-trial/pages/index?k=v#bar</li>
          </ol>
          </aside>

          <p its-locale-filter-list="en" lang="en">The strings of the MiniApp URI scheme must conform to the character set rules of the URI declared in [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc3986" title="Uniform Resource Identifier (URI): Generic Syntax">RFC3986</a></cite>].</p>
          <p its-locale-filter-list="zh-hans" lang="zh-hans">MiniApp URI 的字符串必须要符合在 [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc3986" title="Uniform Resource Identifier (URI): Generic Syntax">RFC3986</a></cite>] 中声明的 URI 的字符集规则。</p>

          <section id="custom-scheme"><div class="header-wrapper"><h3 id="x4-1-custom-scheme"><bdi class="secno">4.1 </bdi>custom-scheme</h3><a class="self-link" href="#custom-scheme" aria-label="Permalink for Section 4.1"></a></div>
            
            <p its-locale-filter-list="en" lang="en">custom-scheme is a miniapp platform identifier to uniquely identify a user agent on a mobile device, usually registered in the operating system (say mobile deep linking technology)</p>
            <p its-locale-filter-list="zh-hans" lang="zh-hans">custom-scheme 是 miniapp 平台的标识，通常会在操作系统中注册（参考 deep linking 技术）。</p>

            <p its-locale-filter-list="en" lang="en">uri-prefix is required, either custom-scheme or https.</p>
            <p its-locale-filter-list="zh-hans" lang="zh-hans">uri-prefix 为必填项，custom-scheme 和 https 的方式二选一。</p>

            <p its-locale-filter-list="en" lang="en">the semantic and syntactic rules for custom-scheme are the same as the scheme in [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc3986" title="Uniform Resource Identifier (URI): Generic Syntax">RFC3986</a></cite>], but the custom scheme does not need to be registered in iana. User agent should ensures that itself is unique in device.</p>
            <p its-locale-filter-list="zh-hans" lang="zh-hans">custom-scheme 的语义规则和语法规则与 [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc3986" title="Uniform Resource Identifier (URI): Generic Syntax">RFC3986</a></cite>] 中的 scheme 一致，但 custom scheme 无需在 <a href="https://www.iana.org/assignments/uri-schemes/uri-schemes.xhtml">iana</a> 中注册，平台保证其在设备唯一即可。</p>
          </section>

          <section id="id"><div class="header-wrapper"><h3 id="x4-2-id"><bdi class="secno">4.2 </bdi>id</h3><a class="self-link" href="#id" aria-label="Permalink for Section 4.2"></a></div>
            
            <p its-locale-filter-list="en" lang="en">id is the logical identifier of the mini app under a specific host, which along with version, points to the unique mini app package of a host. There may be multiple versions of a mini app corresponding to an id under a specific host.</p>
            <p its-locale-filter-list="zh-hans" lang="zh-hans">id 是特定的 host 下的小程序逻辑标识符，与 version 共同指向了 user agent 所使用的 package provider 下唯一的小程序包。在特定的 package provider 下，一个 id 对应的小程序可能会存在多个版本。</p>

            <p its-locale-filter-list="en" lang="en">id is a mandatory field.</p>
            <p its-locale-filter-list="zh-hans" lang="zh-hans">id 为必填项。</p>

            <p its-locale-filter-list="en" lang="en">id consists of non-reserved characters and is not case sensitive.</p>
            <p its-locale-filter-list="zh-hans" lang="zh-hans">id 由非保留字符组成，大小写不敏感。</p>

            <p its-locale-filter-list="en" lang="en">The package provider that the user agent depends on must guarantee the uniqueness of the id.</p>
            <p its-locale-filter-list="zh-hans" lang="zh-hans">user agent 所依赖的 package provider 必须保证 id 的唯一性。</p>
          </section>

          <section id="version"><div class="header-wrapper"><h3 id="x4-3-version"><bdi class="secno">4.3 </bdi>Version</h3><a class="self-link" href="#version" aria-label="Permalink for Section 4.3"></a></div>
            
            <p its-locale-filter-list="en" lang="en">Version and id together represent the unique mini app package of the user agent.</p>
            <p its-locale-filter-list="zh-hans" lang="zh-hans">version 与 id 共同表示了 user agent 下唯一的小程序包。</p>

            <p its-locale-filter-list="en" lang="en">Version is optional, and the user agent can make rules for version, to provide information such as version and development method.</p>
            <p its-locale-filter-list="zh-hans" lang="zh-hans">version 为可选项，user agent 可以对 version 制定规则，用于提供版本、开发方式等信息。</p>

            <p its-locale-filter-list="en" lang="en">Version consists of non-reserved characters and is not case sensitive.</p>
            <p its-locale-filter-list="zh-hans" lang="zh-hans">version 由非保留字符组成，大小写不敏感。</p>

            <p its-locale-filter-list="en" lang="en">In most usage scenarios, it is recommended that the version is null, and the version is managed by user agent and package provider.</p>
            <p its-locale-filter-list="zh-hans" lang="zh-hans">多数使用场景下建议 version 为空，由 user agent 及 package provider 进行版本的管理。</p>
          </section>

          <section id="host-host"><div class="header-wrapper"><h3 id="x4-4-host-host"><bdi class="secno">4.4 </bdi>
              <span its-locale-filter-list="en" lang="en">Host</span>
              <span its-locale-filter-list="zh-hans" lang="zh-hans">host</span>
            </h3><a class="self-link" href="#host-host" aria-label="Permalink for Section 4.4"></a></div>
            
            <p its-locale-filter-list="en" lang="en">
              The semantic rules for the host and port are consistent with the host in [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc3986" title="Uniform Resource Identifier (URI): Generic Syntax">RFC3986</a></cite>] and the port in [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc3986" title="Uniform Resource Identifier (URI): Generic Syntax">RFC3986</a></cite>].
            </p>
            <p its-locale-filter-list="zh-hans" lang="zh-hans">
              host 的语义规则和 [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc3986" title="Uniform Resource Identifier (URI): Generic Syntax">RFC3986</a></cite>] 中的 host 一致。
            </p>

            <p its-locale-filter-list="en" lang="en">
              host has nothing to do with how and where the MiniApp packages is downloaded.
            </p>
            <p its-locale-filter-list="zh-hans" lang="zh-hans">
              host 与 miniapp package 下载方式及下载地址无关。
            </p>
          </section>

          <section id="path"><div class="header-wrapper"><h3 id="x4-5-path"><bdi class="secno">4.5 </bdi>Path</h3><a class="self-link" href="#path" aria-label="Permalink for Section 4.5"></a></div>
            
            <p its-locale-filter-list="en" lang="en">
              Path (optional) represents the path of the mini app resource to be opened. The <a href="https://www.w3.org/TR/miniapp-packaging/">packaging specification</a> defines the resource form, how to locate specific resource path in the package through path, and handling of the user agent when the path value is null or the path pointed by path does not exist.
            </p>
            <p its-locale-filter-list="zh-hans" lang="zh-hans">
              path 表示要打开的小程序资源的路径，可选。在<a href="https://www.w3.org/TR/miniapp-packaging/">包规范</a>中定义了资源的形式，如何通过 path 定位到包内具体的资源路径，以及 path 值为空，或者 path 指向的路径不存在时 user agent 的处理。
            </p>

            <p its-locale-filter-list="en" lang="en">The semantic rules of path are consistent with the path in [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc3986" title="Uniform Resource Identifier (URI): Generic Syntax">RFC3986</a></cite>].</p>
            <p its-locale-filter-list="zh-hans" lang="zh-hans">path 的语义规则和 [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc3986" title="Uniform Resource Identifier (URI): Generic Syntax">RFC3986</a></cite>] 中的 path 一致。</p>
          </section>

          <section id="query-and-fragment-query-fragment"><div class="header-wrapper"><h3 id="x4-6-query-and-fragment-query-fragment"><bdi class="secno">4.6 </bdi>
              <span its-locale-filter-list="en" lang="en">Query and fragment</span>
              <span its-locale-filter-list="zh-hans" lang="zh-hans">query 与 fragment</span>
            </h3><a class="self-link" href="#query-and-fragment-query-fragment" aria-label="Permalink for Section 4.6"></a></div>
            

            <p its-locale-filter-list="en" lang="en">See [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc3986" title="Uniform Resource Identifier (URI): Generic Syntax">RFC3986</a></cite>] for definitions of query and fragment.</p>
            <p its-locale-filter-list="zh-hans" lang="zh-hans">query 与 fragment 的定义参见 [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc3986" title="Uniform Resource Identifier (URI): Generic Syntax">RFC3986</a></cite>]。</p>
          </section>

          </section>

          <section id="dereferencing"><div class="header-wrapper"><h2 id="x5-dereferencing"><bdi class="secno">5. </bdi>
              <span its-locale-filter-list="en" lang="en">Dereferencing</span>
              <span its-locale-filter-list="zh-hans" lang="zh-hans">解引用</span>
            </h2><a class="self-link" href="#dereferencing" aria-label="Permalink for Section 5."></a></div>
            
            <p its-locale-filter-list="en" lang="en">This section describes how the user agent obtains the corresponding mini app package based on MiniApp URI, as well as some error handling.</p>
            <p its-locale-filter-list="zh-hans" lang="zh-hans">此节描述了 user agent 如何根据 MiniApp URI 获得相应的小程序包，以及一些错误的处理。</p>

            <p its-locale-filter-list="en" lang="en">The rules for dereferencing are as follows:</p>
            <p its-locale-filter-list="zh-hans" lang="zh-hans">解引用的规则如下：</p>

            <ol start="1">
              <li>
                <p its-locale-filter-list="en" lang="en">The OS recognizes the MiniApp URI and distributed it to the specified user agent based on the uri-prefix of the URI</p>
                <p its-locale-filter-list="zh-hans" lang="zh-hans">OS 识别 MiniApp URI。并根据 URI 的 uri-prefix 分发到指定的 platform 打开。</p>
              </li>

            <li>
              <p its-locale-filter-list="en" lang="en">User agent recognizes MiniApp URI. If the uri-infix of this URI is <code>miniapp</code>, the user agent considers it as a MiniApp URI and parses the syntax components according to the syntax rules specified in this specification.</p>
              <p its-locale-filter-list="zh-hans" lang="zh-hans">user agent 识别 MiniApp URI。如果该 URI 的 uri-infix 为 <code>miniapp</code>，则 user agent 认为其是 MiniApp URI，并以本规范中规定的语法规则解析语法部件。 </p>
            </li>
            <li>
              <p its-locale-filter-list="en" lang="en">The user agent parses the syntax components of MiniApp URI according to the above syntax rules into id, version, , path, query, and fragment. If the syntax parsing fails, the user agent terminates this dereferencing algorithm.</p>
              <p its-locale-filter-list="zh-hans" lang="zh-hans">user agent 解析 MiniApp URI 语法部件。User agent 依据上述语法规则，将 MiniApp URI 解析为 id、version、path、 query 和 fragment 语法部件。如果语法解析失败，user agent  则终止此解引用算法。</p>
            </li>
            <li>
              <p its-locale-filter-list="en" lang="en">
                User agent usually has two or more ways to get the MiniApp package specified by id, either from the the local file path, or from a remote downloading  package server that provided package download service</p>

              <p its-locale-filter-list="en" lang="en">User agent will give priority to the local path, and if it does not find it, it will fetch it from the remote package server.
                The download process using HTTPS protocol as a download protocol is described in <a href="#https" data-matched-text="[[[#https]]]" class="sec-ref"><bdi class="secno">6. </bdi>
                <span its-locale-filter-list="en" lang="en">Use HTTPS as a network protocol to download MiniApp packages</span>
                <span its-locale-filter-list="zh-hans" lang="zh-hans">使用 HTTPS 协议作为下载小程序包的网络协议</span></a> below.</p>

              <p its-locale-filter-list="en" lang="en">User agent can also provide other custom ways to get MiniApp package. </p>

              <p its-locale-filter-list="zh-hans" lang="zh-hans">user agent 通常会有两种以上方式获取指定 id 的小程序包，一种是从本地路径中查找，一种是从远程的提供小程序包下载服务的 package server 获取。</p>
              <p its-locale-filter-list="zh-hans" lang="zh-hans">user agent 会优先从本地路径中查找，如果从本地路径中未查找到，则会从远程的 package server 获取。使用 HTTPS 协议作为下载协议的下载过程见<a href="#https" data-matched-text="[[[#https]]]" class="sec-ref" lang="en"><bdi class="secno">6. </bdi>
                <span its-locale-filter-list="en" lang="en">Use HTTPS as a network protocol to download MiniApp packages</span>
                <span its-locale-filter-list="zh-hans" lang="zh-hans">使用 HTTPS 协议作为下载小程序包的网络协议</span></a>。</p>
              <p its-locale-filter-list="zh-hans" lang="zh-hans">user agent 也可以提供其他自定义的获取小程序包来源的方式。</p>
            </li>
            </ol>

            <ol start="5">
            <li>
              <p its-locale-filter-list="en" lang="en">The user agent uses id as a mini app logic identifier for package provider. The mini app with specified id may have multiple versions in the package provider</p>
              <p its-locale-filter-list="zh-hans" lang="zh-hans">
                user agent 将 id 作为 package provider 下的小程序逻辑标识符。在特定 package provider 下，一个指定 id 的小程序可能会存在多个版本。
              </p>
            </li>
            <li>
              <p its-locale-filter-list="en" lang="en">The user agent uses version as the version information of the mini app package with the specified id. The user agent handles different existence modes of version: For example</p>
              <p its-locale-filter-list="zh-hans" lang="zh-hans">
                user agent 将 version 作为指定 id 的小程序包的版本信息。User agent 需要处理 version 的不同存在方式：比如
              </p>
            </li>
            </ol>

            <p its-locale-filter-list="en" lang="en">When version has a value, the version is used as the version information of the mini app package, which along with id, points to the unique mini app package of a package provider.</p>
            <p its-locale-filter-list="zh-hans" lang="zh-hans">当 version 存在值时，将 version 作为小程序包的版本信息，与 id 共同指向某个 package provider 唯一的小程序包。</p>

            <p its-locale-filter-list="en" lang="en">When version is null, the mini app package with specified id is customized as an mini app package provider (package server or user agent), which can be the latest version or the default version of the mini app package with specified id, or the mini app package of a version that conforms to a mapping rule.</p>
            <p its-locale-filter-list="zh-hans" lang="zh-hans">当 version 为空值时，将会以小程序包 provider （package server or user agent）自定义提供指定 id 的小程序包，可以是该指定 id 的小程序包的最新版本、或者是默认版本、或者是符合某种映射规则的版本的小程序包。</p>

            <p its-locale-filter-list="en" lang="en">In most usage scenarios, it is recommended that the version is null, and the version is managed by the user agent and package provider.</p>
            <p its-locale-filter-list="zh-hans" lang="zh-hans">多数使用场景下建议 version 为空，由 user agent 及 package provider 进行版本的管理。</p>

            <ol start="6">
            <li>
              <p its-locale-filter-list="en" lang="en">The user agent obtains the mini app package based on the parsed provider information and the identification information of the mini app (e.g., id, version). The user agent handles different situations of the provider:</p>
              <p its-locale-filter-list="zh-hans" lang="zh-hans">user agent 根据解析到的 provider 的信息及小程序的标识信息（比如 id、version）获取小程序的包。User agent 需要处理 provider 不同的情况：</p>
            </li>
            </ol>

            <p its-locale-filter-list="en" lang="en">When provider is a package server, the user agent sends an HTTPS Request with mini app identification information to the server; the final mini app package is obtained by handling the Response body returned by the package server.</p>
            <p its-locale-filter-list="zh-hans" lang="zh-hans">当 provider 为 package server 时，user agent 向该服务器发起携带了小程序标识信息的 HTTPS Request；通过处理 package server 返回的 Response body 得到最终的小程序包。</p>

            <p its-locale-filter-list="en" lang="en">When provider is a custom method of the user agent, the user agent obtains the mini app package with specified mini app identification information through the custom method.</p>
            <p its-locale-filter-list="zh-hans" lang="zh-hans">当 provider 为 user agent 自定义的方式时，user agent 通过该自定义方式获取指定小程序标识信息的小程序包。</p>

            <ol start="7">
            <li>
              <p its-locale-filter-list="en" lang="en">The user agent conducts corresponding processing based on the results of the obtained mini app package:</p>
              <p its-locale-filter-list="zh-hans" lang="zh-hans">user agent 根据获取小程序包的结果，进行相应的处理：</p>
            </li>
            </ol>

            <p its-locale-filter-list="en" lang="en">When the mini app package is obtained successfully, the following processing is performed.</p>
            <p its-locale-filter-list="zh-hans" lang="zh-hans">当获取小程序包成功时，则进行接下来的处理。</p>

            <p its-locale-filter-list="en" lang="en">When obtaining the mini app package fails, exception handling is performed based on the cause of failure. For example, when the user agent cannot obtain the package from the host, the error code and error message are returned.</p>
            <p its-locale-filter-list="zh-hans" lang="zh-hans">当获取小程序包失败时，则根据失败原因，做出异常处理。例如 user agent 从 host 无法获取到包时，返回错误码与错误信息。</p>

            <ol start="8">
            <li>
              <p its-locale-filter-list="en" lang="en">
                The user agent locates the corresponding mini app resource based on the path, query, fragment and the method defined in <a href="https://w3c.github.io/miniapp/specs/manifest/">MiniApp Manifest</a> specification.
              </p>
              <p its-locale-filter-list="zh-hans" lang="zh-hans">
                user agent 根据 path、query、fragment 以及 <a href="https://w3c.github.io/miniapp/specs/manifest/">小程序 Manifest 规范</a> 中定义的方式定位到对应的小程序资源。
              </p>
            </li>
            </ol>

            <p its-locale-filter-list="en" lang="en">The user agent <em class="rfc2119">MUST</em> handle any failure during dereferencing and provide appropriate information prompts.</p>
            <p its-locale-filter-list="zh-hans" lang="zh-hans">user agent <em class="rfc2119">MUST</em> 处理解引用过程中任何失败的情况，并给出合适的信息提示。</p>
            </section>

            <section class="informative" id="https"><div class="header-wrapper"><h2 id="x6-use-https-as-a-network-protocol-to-download-miniapp-packages-https"><bdi class="secno">6. </bdi>
                <span its-locale-filter-list="en" lang="en">Use HTTPS as a network protocol to download MiniApp packages</span>
                <span its-locale-filter-list="zh-hans" lang="zh-hans">使用 HTTPS 协议作为下载小程序包的网络协议</span>
              </h2><a class="self-link" href="#https" aria-label="Permalink for Section 6."></a></div><p><em>This section is non-normative.</em></p>
              

              <p its-locale-filter-list="en" lang="en">This section describes a use case scenario for a network protocol that uses HTTPS protocol as a request to download the mini app package.</p>
              <p its-locale-filter-list="zh-hans" lang="zh-hans">此节描述了以使用 HTTPS 协议作为请求下载小程序包的网络协议的用例场景。</p>

              <p its-locale-filter-list="en" lang="en">Use the following URI for example:</p>
              <p its-locale-filter-list="zh-hans" lang="zh-hans">接下来以此 URI 为例：</p>

              <pre aria-busy="false"><code class="hljs javascript">platform:<span class="hljs-comment">//miniapp/foo;version=1.0.1-trial/pages/index?category=book#section-3</span></code></pre>

              <p its-locale-filter-list="en" lang="en">Dereferencing steps are as follows:</p>
              <p its-locale-filter-list="zh-hans" lang="zh-hans">解引用步骤如下：</p>

              <ol>
              <li>
                <p its-locale-filter-list="en" lang="en">
                  If the URI does not conform to the syntax rules of MiniApp URI, the user agent does not respond or handle exceptions.
                </p>
                <p its-locale-filter-list="zh-hans" lang="zh-hans">如果 URI 不符合 MiniApp URI 语法规则，则 User agent 不做响应或进行异常处理。</p>
              </li>
              <li>
                <p its-locale-filter-list="en" lang="en">
                  Use the HTTPS URL to get the package with the id and version as request parameters: https://example.com/getPackage?id=foo&amp;version=1.0.1-trial
                </p>
                <p its-locale-filter-list="zh-hans" lang="zh-hans">以 GET 请求将 id 和 version 作为请求参数，使用获取包的 URL 拼接完整 URL： https://example.com/getPackage?id=foo&amp;version=1.0.1-trial</p>
              </li>
              <li>
                <p its-locale-filter-list="en" lang="en">
                  The user agent may implement HTTP cache control; it is recommended to use gzip as the encoding scheme (HTTP accept-encoding) and send HTTPS request message.
                </p>
                <p its-locale-filter-list="zh-hans" lang="zh-hans">user agent may 实现 HTTP 缓存控件；推荐使用 gzip 作为编码方式（HTTP accept-encoding），发送 HTTPS 请求报文。</p>
              </li>
              <li>
                <p its-locale-filter-list="en" lang="en">
                  If the received request is not an HTTPS request, an HTTP 403 forbidden response is returned, and the request is terminated.
                </p>
                <p its-locale-filter-list="zh-hans" lang="zh-hans">如果接受到请求不是 HTTPS 请求，则返回 HTTP 403 禁止响应，并终止此请求。</p>

              </li>
              <li>
                <p its-locale-filter-list="en" lang="en">
                  If the received request fails to pass authentication, an HTTP 403 forbidden response is returned, and the request is terminated.
                </p>
                <p its-locale-filter-list="zh-hans" lang="zh-hans">如果接受到的请求未通过鉴权，则返回 HTTP 403 禁止响应，并终止此请求。</p>
              </li>
              <li>
                <p its-locale-filter-list="en" lang="en">
                  If the requested HTTP Method is not supported, an HTTP 501 Not Implemented response is returned, and the request is terminated.
                </p>
              <p its-locale-filter-list="zh-hans" lang="zh-hans">如果该请求的 HTTP Method 不被支持，则返回 HTTP 501 Not Implemented 响应并终止此请求。</p>
              </li>
              <li>
                <p its-locale-filter-list="en" lang="en">
                  Based on the query or body carried in the requested URL, a mini app package with id “foo”, version “1.0.1” is returned. If it is not found, an HTTP 404 Not Found response is returned.
                </p>
              <p its-locale-filter-list="zh-hans" lang="zh-hans">根据请求 URL 所携带的 query 或者 body， 返回 id 为 “foo”，version 为“1.0.1” 的小程序包。如果找不到，则返回 HTTP 404 Not Found 响应。</p>

              </li>
              <li>
                <p its-locale-filter-list="en" lang="en">
                  If it is successfully found, an HTTP 200 OK response is returned, and the mini app package is returned as the response body in the format specified by content-type.
                </p>
              <p its-locale-filter-list="zh-hans" lang="zh-hans">如果成功找到，则以 HTTP 200 OK 响应，并将小程序包以 content-type 指定的格式作为响应主体返回。</p>
              </li>
              <li>
                <p its-locale-filter-list="en" lang="en">
                  The user agent determines whether the request is successful based on status and continues to parse the response body when status is 200. A failure exception is processed when status is not 200.
                </p>
              <p its-locale-filter-list="zh-hans" lang="zh-hans">user agent 根据 status 来判断请求是否成功，当 status 为 200 时，则继续解析响应体。当 status 不为 200 时，则处理失败异常。</p>
              </li>
              <li>
                <p its-locale-filter-list="en" lang="en">
                  It is recommended to use the agreed unique identification field to reverify the package integrity.
                </p>
              <p its-locale-filter-list="zh-hans" lang="zh-hans">建议使用约定的唯一标识字段再次校验包的完整性。</p>
              </li>
              <li>
                <p its-locale-filter-list="en" lang="en">
                  For downloaded mini app package, use the package format specified in the <a href="https://www.w3.org/TR/miniapp-packaging/">MiniApp Packaging</a> specification to decompress.
                </p>
              <p its-locale-filter-list="zh-hans" lang="zh-hans">对于下载好的小程序包，使用<a href="https://www.w3.org/TR/miniapp-packaging/">小程序打包规范</a>中规定的包格式进行解压缩。</p>
              </li>
              </ol>
              </section>

              <section id="conformance" class="override"><div class="header-wrapper"><h2 id="x7-conformance"><bdi class="secno">7. </bdi>
                  <span its-locale-filter-list="en" lang="en">Conformance</span>
                  <span its-locale-filter-list="zh-hans" lang="zh-hans">标准符合性</span>
                </h2><a class="self-link" href="#conformance" aria-label="Permalink for Section 7."></a></div>
                
                <p its-locale-filter-list="en" lang="en">
                  As well as sections marked as non-normative, all authoring guidelines, diagrams, examples, and notes in this specification are non-normative. Everything else in this specification is normative.
                </p>
                <p its-locale-filter-list="zh-hans" lang="zh-hans">
                  本规范中的所有内容均为本草案的规范性内容，但明确标记为“非规范性”的部分、示例和注释除外。
                </p>

                <p its-locale-filter-list="en" lang="en">There is one class of products that can conform to this specification, and that is the user agent above. </p>

                <p its-locale-filter-list="zh-hans" lang="zh-hans">
                  有一类产品可以声明符合此规范，即上文中的 user agent。
                </p>
              </section>


              <section class="informative" id="security-considerations"><div class="header-wrapper"><h2 id="x8-security-considerations"><bdi class="secno">8. </bdi>
                  <span its-locale-filter-list="en" lang="en">Security Considerations</span>
                  <span its-locale-filter-list="zh-hans" lang="zh-hans">安全性考虑</span>
                </h2><a class="self-link" href="#security-considerations" aria-label="Permalink for Section 8."></a></div><p><em>This section is non-normative.</em></p>
                
                    <ol>
                      <li>
                        <p its-locale-filter-list="en" lang="en">The user agent needs to ensure the correctness of URI, avoid URI tampering and prevent phishing attacks, for example, by using the recommendations in [<cite><a class="bibref" data-link-type="biblio" href="#bib-utr36" title="Unicode Security Considerations">UTR36</a></cite>].</p>
                      <p its-locale-filter-list="zh-hans" lang="zh-hans">User agent 需要保证 URI 的正确性，避免 URI 篡改，防止钓鱼攻击。比如，[<cite><a class="bibref" data-link-type="biblio" href="#bib-utr36" title="Unicode Security Considerations">UTR36</a></cite>] 中的技术可用于解决一部分安全问题。</p>
                        </li>
                      <li>
                        <p its-locale-filter-list="en" lang="en">It is recommended that UA or sign signature are used to authenticate the request process on the package server side.</p>
                        <p its-locale-filter-list="zh-hans" lang="zh-hans">请求过程建议通过 UA 或者 sign 签名的方式，进行 package server 端的鉴权认证。</p>
                      </li>
                      <li>
                        <p its-locale-filter-list="en" lang="en">During the request process, it is recommended to check replay attacks using HMAC.</p>
                      <p its-locale-filter-list="zh-hans" lang="zh-hans">请求过程中，建议通过 HMAC 的方式进行防重放攻击检查。</p>
                      </li>
                      <li>
                        <p its-locale-filter-list="en" lang="en">During the request process, it is recommended to verify package integrity by abstract comparison of md5 or sha1.</p>
                      <p its-locale-filter-list="zh-hans" lang="zh-hans">请求过程中，建议通过 md5 或 sha1 的摘要比对方式，验证包完整性。</p>
                      </li>
                      <li>
                        <p its-locale-filter-list="en" lang="en">While parsing the Response by the user agent, it is recommended to protect the data package security through encryption and decryption.</p>
                      <p its-locale-filter-list="zh-hans" lang="zh-hans">user agent 解析 Response 过程中，建议通过加解密方式进行数据包的安全性保护。</p>

                      </li>
                      <li>
                        <p its-locale-filter-list="en" lang="en">When the user agent stores the package resource locally, it is necessary to ensure the storage security of files, to protect against malware attacks.</p>
                      <p its-locale-filter-list="zh-hans" lang="zh-hans">user agent 本地存储包资源时，需要保证文件的存储安全，防止恶意软件攻击。</p>
                      </li>
                    </ol>
                </section>

    <section class="appendix" id="acknowledgments"><div class="header-wrapper"><h2 id="a-acknowledgments"><bdi class="secno">A. </bdi>
        <span its-locale-filter-list="en" lang="en">Acknowledgments</span>
        <span its-locale-filter-list="zh-hans" lang="zh-hans">致谢</span>
      </h2><a class="self-link" href="#acknowledgments" aria-label="Permalink for Appendix A."></a></div>
      
      <p its-locale-filter-list="en" lang="en">The editors thank to Baidu Smart Mini Program team for reviewing this document over and over again, thank to the <abbr title="World Wide Web Consortium">W3C</abbr> MiniApps Community Group for providing a lot of valuable advice.</p>
      <p its-locale-filter-list="zh-hans" lang="zh-hans">编辑者感谢百度智能小程序团队对本文档的反复评审，感谢 <abbr title="World Wide Web Consortium">W3C</abbr> 小程序社区组成员提供了宝贵的意见。</p>
    </section>


    <section class="appendix" id="references-0"><div class="header-wrapper"><h2 id="b-references"><bdi class="secno">B. </bdi>
        <span its-locale-filter-list="en" lang="en">References</span>
        <span its-locale-filter-list="zh-hans" lang="zh-hans">引用</span>
      </h2><a class="self-link" href="#references-0" aria-label="Permalink for Appendix B."></a></div>
      
      <p>Android App Links：https://developer.android.com/training/app-links</p>
      <p>iOS Deep Linking: https://developer.apple.com/documentation/xcode/allowing-apps-and-websites-to-link-to-your-content</p>
    </section>



<section id="references" class="appendix"><div class="header-wrapper"><h2 id="c-references"><bdi class="secno">C. </bdi>References</h2><a class="self-link" href="#references" aria-label="Permalink for Appendix C."></a></div><section id="normative-references"><div class="header-wrapper"><h3 id="c-1-normative-references"><bdi class="secno">C.1 </bdi>Normative references</h3><a class="self-link" href="#normative-references" aria-label="Permalink for Appendix C.1"></a></div>
    
    <dl class="bibliography"><dt id="bib-abnf">[ABNF]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc5234"><cite>Augmented BNF for Syntax Specifications: ABNF</cite></a>. D. Crocker, Ed.; P. Overell.  IETF. January 2008. Internet Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc5234">https://www.rfc-editor.org/rfc/rfc5234</a>
    </dd><dt id="bib-rfc3986">[RFC3986]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc3986"><cite>Uniform Resource Identifier (URI): Generic Syntax</cite></a>. T. Berners-Lee; R. Fielding; L. Masinter.  IETF. January 2005. Internet Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc3986">https://www.rfc-editor.org/rfc/rfc3986</a>
    </dd></dl>
  </section><section id="informative-references"><div class="header-wrapper"><h3 id="c-2-informative-references"><bdi class="secno">C.2 </bdi>Informative references</h3><a class="self-link" href="#informative-references" aria-label="Permalink for Appendix C.2"></a></div>
    
    <dl class="bibliography"><dt id="bib-miniapp-packaging">[MINIAPP-PACKAGING]</dt><dd>
      <a href="https://www.w3.org/TR/miniapp-packaging/"><cite>MiniApp Packaging</cite></a>. Martin Alvarez-Espinar; Qing An; Tengyuan Zhang; Yongjing ZHANG; Dan Zhou.  W3C. 25 February 2022. W3C Working Draft. URL: <a href="https://www.w3.org/TR/miniapp-packaging/">https://www.w3.org/TR/miniapp-packaging/</a>
    </dd><dt id="bib-utr36">[UTR36]</dt><dd>
      <a href="https://www.unicode.org/reports/tr36/tr36-15.html"><cite>Unicode Security Considerations</cite></a>. Mark Davis; Michel Suignard.  Unicode Consortium. 19 September 2014. Unicode Technical Report #36. URL: <a href="https://www.unicode.org/reports/tr36/tr36-15.html">https://www.unicode.org/reports/tr36/tr36-15.html</a>
    </dd></dl>
  </section></section><p role="navigation" id="back-to-top">
    <a href="#title"><abbr title="Back to Top">↑</abbr></a>
  </p><script id="respec-dfn-panel">(() => {
// @ts-check
if (document.respec) {
  document.respec.ready.then(setupPanel);
} else {
  setupPanel();
}

function setupPanel() {
  const listener = panelListener();
  document.body.addEventListener("keydown", listener);
  document.body.addEventListener("click", listener);
}

function panelListener() {
  /** @type {HTMLElement} */
  let panel = null;
  return event => {
    const { target, type } = event;

    if (!(target instanceof HTMLElement)) return;

    // For keys, we only care about Enter key to activate the panel
    // otherwise it's activated via a click.
    if (type === "keydown" && event.key !== "Enter") return;

    const action = deriveAction(event);

    switch (action) {
      case "show": {
        hidePanel(panel);
        /** @type {HTMLElement} */
        const dfn = target.closest("dfn, .index-term");
        panel = document.getElementById(`dfn-panel-for-${dfn.id}`);
        const coords = deriveCoordinates(event);
        displayPanel(dfn, panel, coords);
        break;
      }
      case "dock": {
        panel.style.left = null;
        panel.style.top = null;
        panel.classList.add("docked");
        break;
      }
      case "hide": {
        hidePanel(panel);
        panel = null;
        break;
      }
    }
  };
}

/**
 * @param {MouseEvent|KeyboardEvent} event
 */
function deriveCoordinates(event) {
  const target = /** @type HTMLElement */ (event.target);

  // We prevent synthetic AT clicks from putting
  // the dialog in a weird place. The AT events sometimes
  // lack coordinates, so they have clientX/Y = 0
  const rect = target.getBoundingClientRect();
  if (
    event instanceof MouseEvent &&
    event.clientX >= rect.left &&
    event.clientY >= rect.top
  ) {
    // The event probably happened inside the bounding rect...
    return { x: event.clientX, y: event.clientY };
  }

  // Offset to the middle of the element
  const x = rect.x + rect.width / 2;
  // Placed at the bottom of the element
  const y = rect.y + rect.height;
  return { x, y };
}

/**
 * @param {Event} event
 */
function deriveAction(event) {
  const target = /** @type {HTMLElement} */ (event.target);
  const hitALink = !!target.closest("a");
  if (target.closest("dfn:not([data-cite]), .index-term")) {
    return hitALink ? "none" : "show";
  }
  if (target.closest(".dfn-panel")) {
    if (hitALink) {
      return target.classList.contains("self-link") ? "hide" : "dock";
    }
    const panel = target.closest(".dfn-panel");
    return panel.classList.contains("docked") ? "hide" : "none";
  }
  if (document.querySelector(".dfn-panel:not([hidden])")) {
    return "hide";
  }
  return "none";
}

/**
 * @param {HTMLElement} dfn
 * @param {HTMLElement} panel
 * @param {{ x: number, y: number }} clickPosition
 */
function displayPanel(dfn, panel, { x, y }) {
  panel.hidden = false;
  // distance (px) between edge of panel and the pointing triangle (caret)
  const MARGIN = 20;

  const dfnRects = dfn.getClientRects();
  // Find the `top` offset when the `dfn` can be spread across multiple lines
  let closestTop = 0;
  let minDiff = Infinity;
  for (const rect of dfnRects) {
    const { top, bottom } = rect;
    const diffFromClickY = Math.abs((top + bottom) / 2 - y);
    if (diffFromClickY < minDiff) {
      minDiff = diffFromClickY;
      closestTop = top;
    }
  }

  const top = window.scrollY + closestTop + dfnRects[0].height;
  const left = x - MARGIN;
  panel.style.left = `${left}px`;
  panel.style.top = `${top}px`;

  // Find if the panel is flowing out of the window
  const panelRect = panel.getBoundingClientRect();
  const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width);
  if (panelRect.right > SCREEN_WIDTH) {
    const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width);
    const newCaretOffset = left - newLeft;
    panel.style.left = `${newLeft}px`;
    /** @type {HTMLElement} */
    const caret = panel.querySelector(".caret");
    caret.style.left = `${newCaretOffset}px`;
  }

  // As it's a dialog, we trap focus.
  // TODO: when <dialog> becomes a implemented, we should really
  // use that.
  trapFocus(panel, dfn);
}

/**
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function trapFocus(panel, dfn) {
  /** @type NodeListOf<HTMLAnchorElement> elements */
  const anchors = panel.querySelectorAll("a[href]");
  // No need to trap focus
  if (!anchors.length) return;

  // Move focus to first anchor element
  const first = anchors.item(0);
  first.focus();

  const trapListener = createTrapListener(anchors, panel, dfn);
  panel.addEventListener("keydown", trapListener);

  // Hiding the panel releases the trap
  const mo = new MutationObserver(records => {
    const [record] = records;
    const target = /** @type HTMLElement */ (record.target);
    if (target.hidden) {
      panel.removeEventListener("keydown", trapListener);
      mo.disconnect();
    }
  });
  mo.observe(panel, { attributes: true, attributeFilter: ["hidden"] });
}

/**
 *
 * @param {NodeListOf<HTMLAnchorElement>} anchors
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function createTrapListener(anchors, panel, dfn) {
  const lastIndex = anchors.length - 1;
  let currentIndex = 0;
  return event => {
    switch (event.key) {
      // Hitting "Tab" traps us in a nice loop around elements.
      case "Tab": {
        event.preventDefault();
        currentIndex += event.shiftKey ? -1 : +1;
        if (currentIndex < 0) {
          currentIndex = lastIndex;
        } else if (currentIndex > lastIndex) {
          currentIndex = 0;
        }
        anchors.item(currentIndex).focus();
        break;
      }

      // Hitting "Enter" on an anchor releases the trap.
      case "Enter":
        hidePanel(panel);
        break;

      // Hitting "Escape" returns focus to dfn.
      case "Escape":
        hidePanel(panel);
        dfn.focus();
        return;
    }
  };
}

/** @param {HTMLElement} panel */
function hidePanel(panel) {
  if (!panel) return;
  panel.hidden = true;
  panel.classList.remove("docked");
}
})()</script><script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script></body></html>